{% extends 'base.html' %}

{% load static %}
{% load wt_extras %}

{% block title %}{{ block.super }} - New Survey{% endblock %}

{% block css %}
  {{ block.super }}
{% endblock %}

{% block script %}
{{ block.super }}
<script src="{% static 'jquery/jquery.js' %}"></script>
<script>
  $(function() {
    $( "#type" ).change(function() {
      $(".conditional-questions > div").hide();
      $(".conditional-questions #" + $(this).val()).show();
    });
    $("#type").prop('selectedIndex', -1);
  });
  function add_category() {
    var num = $("#cat-list > input").length + 1;
    $("#cat-list").append('<input type="text" id="cat' + num + '" name="cat' + num + '" class="form-control" placeholder="Category ' + num + '">');
    $("#cat-list > input").last().focus();
  }
</script>
{% endblock %}

{% block content %}
<h2>Create a new survey</h2>
<hr />

<form class="form-horizontal col-md-6 col-md-offset-3" action="{% url 'create_survey' %}" method="post">
    {% csrf_token %}

    {% if status.no_title %}
        <script type="text/javascript">
            $.notify.defaults({ globalPosition: "top center" });
            $.notify("No title provided. Please, enter a title.", "error");
        </script>
    {% endif %}

    <div class="New Survey">
        
    <div class="form-group">
        <label for="title" class="col-sm-3 control-label">Title</label>
        <div class="col-sm-9">
            <input type="text" name="surveytitle" class="form-control" id="surveytitle" placeholder="Type in title">
            <p class="help-block">Give a title to this survey</p>
        </div>
    </div>

    <div class="form-group">
        <label for="choosepatient" class="col-sm-3 control-label">Select patient(s)</label>
        <div class="col-sm-9"> <!-- <p>Select patient(s) for this survey:</p> -->
        {% for patient in patients %}
        <input type="checkbox" name="chk_patients" value="{{patient.user.id}}" />{% firstof patient.user.get_full_name patient.user.username|title %}<br />
        {% endfor %}
        </div>
    </div>
    </div>
    
    <h2>Add New Question</h2>
    <hr />
    
    <div class="form-group">
    <label for="title" class="col-sm-2 control-label">Title</label>
    <div class="col-sm-10">
      <input type="text" name="title" class="form-control" id="question" placeholder="Happiness...">
      <p class="help-block">A small 1-2 word title that describes your questions</a>
    </div>
  </div>
  <div class="form-group">
    <label for="question" class="col-sm-2 control-label">Question</label>
    <div class="col-sm-10">
      <input type="text" name="text" class="form-control" id="question" placeholder="How is...">
      <p class="help-block">Type the question that you would like to appear to the user.</p>
    </div>
  </div>
  <div class="form-group">
    <label for="description" class="col-sm-2 control-label">Description</label>
    <div class="col-sm-10">
      <input type="text" name="description" class="form-control" id="description" placeholder="Answer on a scale of 1-10">
    </div>
  </div>
  <div class="form-group">
    <label for="description" class="col-sm-2 control-label">Target</label>
    <div class="col-sm-10">
      <input type="text" name="goal" class="form-control" id="goal" placeholder="Target value for this question">
    </div>
  </div>
    <div class="form-group">
    <label for="question_type" class="col-sm-2 control-label">Type</label>
    <div class="col-sm-10">
      <select id="type" name="type" class="form-control">
        <option value="slider">Slider</option>
        <option value="category">Category</option>
        <option value="boolean">Yes / No</option>
        <option value="integer">Numerical</option>
      </select>
    </div>
  </div>
  <div class="conditional-questions">
    <div id="slider" class="form-group" style="display: none;">
      <p class="help-block">Give the upper and lower bound for the slider, as well as the increment.</p>
      <div class="row text-center">
        <div class="col-sm-4">
          <label for="slider-min_value">Lower Bound</label>
          <input type="text" name="min_value" id="slider-min_value" class="form-control text-center" value="0">
        </div>
        <div class="col-sm-4">
          <label for="slider-max_value">Upper Bound</label>
          <input type="text" name="max_value" id="slider-max_value" class="form-control text-center" value="100">
        </div>
        <div class="col-sm-4">
          <label for="slider-increment">Increment</label>
          <input type="text" name="increment" id="slider-increment" class="form-control text-center" value="5">
        </div>
      </div>
    </div>
    <div id="category" class="form-group" style="display: none;">
      <p class="help-block">Add categories for this question</p>
      <div id="cat-list">
        <input type="text" id="cat1" name="cat1" class="form-control" placeholder="Category 1">
      </div>
      <div class="text-center">
        <a href="#" onClick="add_category()" class="btn btn-default text-center"><i class="glyphicon glyphicon-plus text-success"></i> Add Category</a>
      </div>
    </div>
    <div id="integer" class="form-group" style="display: none;">
      <label for="units" class="col-sm-2 control-label">Units</label>
      <div class="col-sm-10">
        <input type="text" name="units" id="units" class="form-control" placeholder="Kg, Hours, Snacks...">
      </div>
    </div>
  </div>
    
    
    
    <center><a href="{% url 'create_survey' %}" class="list-group-item inactive"><i class="glyphicon glyphicon-plus text-success" style="margin-right: 10px;"></i>Add Next Question</a></center>
    <center><a href="{% url 'create_survey' %}" class="list-group-item inactive"><i class="glyphicon glyphicon-plus text-success" style="margin-right: 10px;"></i>Select Question from the bank</a></center>

    <div class="submit text-center">
        <input type="submit" class="btn btn-lg btn-success" value="Create"></input>
        <a href="{% url 'manage_surveys' %}" class="btn btn-lg btn-success">Back</a>
    </div>
</form>

{% endblock %}
